
function fillDateRange(c,a){var g=$("#"+c).val(),e=$("#"+a).val(),f=new Date(),b="";if(f.getDate()<10){b+="0"}b+=f.getDate()+"/";if(f.getMonth()<9){b+="0"}b+=(f.getMonth()+1)+"/";$("#"+c).val(b+(f.getFullYear()-1));$("#"+a).val(b+f.getFullYear())}function openLoadingDialog(a){a=a||Translation.TEXT7001;if($("#loadingDialog").is(":data(dialog)")||$("#loadingDialog").is(":data(uiDialog)")){$("#loadingDialog").dialog("destroy")}if(!$("#loadingDialog").length){$("body").append('<div id="loadingDialog" class="loadingDialog"></div>')}$("#loadingDialog").html('<span class="span-loading f-l"></span> <span style="float:left;padding:10px 0 0 10px;">'+a+"</span>").dialog({resizable:false,width:"auto",zIndex:3000,minHeight:32,modal:true}).closest(".ui-dialog").find(".ui-dialog-titlebar").hide()}function closeLoadingDialog(){if($("#loadingDialog").is(":data(dialog)")||$("#loadingDialog").is(":data(uiDialog)")){$("#loadingDialog").dialog("close").remove()}}SEARCH={};RefineSEARCH={};(function(a){var b=a.jQuery;b(document).on("click",".ac-hl-link",function(c){c.preventDefault();if(b(this).closest(".resultsWrapper").attr("id")==="resultsWrapperRefine"){b("#keyword_search").val(b(this).text());searchSubmit()}if(b(this).closest(".resultsWrapper").attr("id")==="resultsWrapper"){b("#megasearch-keyword").val(b(this).text())}});b(document.body).on("click",".ac-filter-bubble-close",function(c){b(this).closest(".ac-filter-bubble").remove()});b(document.body).on("click",".ac-filter-bubble-skip",function(c){SEARCH.SetCookie("ac-bubble",1,365);b(this).closest(".ac-filter-bubble").remove()});b(document.body).on("click",".ac-filter-link",function(o){o.preventDefault();var n=b(this);var l="search";var p=SEARCH;if(n.closest("#resultsWrapperRefine").length>0){l="refine";p=RefineSEARCH}var e=b(this).attr("data-type");var q=b(this).attr("data-id");var A=b(this).attr("data-key");var y=b(this).attr("data-keyword");var c=q.split(",");var g=(l==="refine")?b("#search_form"):b("#advanced-mega-search-form");var d=g.find('[name="'+e+'[]"]');var s=[];if(p.autocompleteFilters.hasOwnProperty(e)&&d.val()){s=d.val()}else{p.autocompleteFilters[e]={}}p.autocompleteFilters[e][A]=1;for(var u in c){s.push(c[u])}d.val(s).multiselect("refresh");if(l==="search"){if(d.closest(".filter-wraper:visible").length===0){d.closest(".filter-wraper").show()}}if(l==="refine"){var f=SEARCH.GetCookie("ac-bubble");if(!f){var w=[];for(var u in c){s.push(c[u]);if(d.find('option[value="'+c[u]+'"]').length){var k=d.find('option[value="'+c[u]+'"]').html().replace(/\s+\(\d+\)$/,"");w.push(k)}}var r={"ptyp[]":"content type","prod[]":"country","indu[]":"industry"};if(w.length>0){var h=r[d.attr("name")];var j=w.join(", ");var x="Your {category} filter is now setup to {value}";var m=x.replace("{category}",h).replace("{value}",j);var v='<div class="div-tooltip-common ac-filter-bubble" style="visibility: visible; display: block;">\n        <a href="javascript:;" class="div-tooltip-common-close ac-filter-bubble-close">X</a>\n        <div class="div-tooltip-common-content" role="dialog"><p>{MESSAGE}</p>\n        <div class="ta-l"><a href="javascript:;" class="ac-filter-bubble-skip">'+Translation.TEXT11447+"</a></div>\n        </div>\n        </div>";var t=b(v.replace("{MESSAGE}",m));d.after(t);setTimeout(function(){t.remove()},5000)}}}var z=p.$keyword.val();z=z.replace(y,"");p.$keyword.val(z);p.$keyword.trigger("keyup");p.$keyword.trigger("focus");if(l==="refine"){swapSelects(".search-filters",".search-filters-out");searchSubmit()}});SEARCH={minLength:2,autoCompleteDelay:300,disableSubmit:false,showAdvancedSearch:false,autocompleteFilters:{},autocompleteCache:{},filter:function(e,c){var d=new RegExp("(^| )"+b.ui.autocomplete.escapeRegex(c),"i");return b.grep(e,function(f){return d.test(f.label)||d.test(f.value)||d.test(f)})},hashCode:function(f){var e=0,c=f.length,d=0;if(c>0){while(d<c){e=(e<<5)-e+f.charCodeAt(d++)|0}}return e},init:function(){SEARCH.$keyword=b("#megasearch-keyword").on("keyup",SEARCH.keywordKeyUp).on("focus click",SEARCH.keywordFocus);SEARCH.$form=SEARCH.$keyword.closest("form").on("submit",SEARCH.search);SEARCH.$resultsHolder=b('<div id="resultsWrapper" class="resultsWrapper w-63"><div id="resultsHolderFilter" class="d-n"></div><div id="resultsHolder" class="resultsHolder">Searching...</div></div>').insertAfter(SEARCH.$form);b(document.body).on("click",SEARCH.checkCloseResults);var c=b("#saved-searches-header").html();SEARCH.$resultsHolder.find("#resultsHolder").html(c)},checkCloseResults:function(c){var d=b(c.srcElement);SEARCH.showAdvancedSearch=true;if(c.target.id!=="megasearch-keyword"&&!b(c.target).closest(".ac-hl-link").length&&!b(c.target).closest(".ac-filter-link").length&&!b(c.target).closest("#resultsWrapper").length&&!b(c.target).closest("#mega-filter-wrapper").length&&!b(c.target).closest(".mega-filter-multiselect").length&&!b(c.target).closest(".ui-datepicker-header").length&&!b(c.target).closest("#ui-datepicker-div").length||b(c.target).closest("#advanced-mega-search-submit-btn").length){SEARCH.closeResults();SEARCH.closeAdvancedSearch();SEARCH.showAdvancedSearch=false}},closeResults:function(){SEARCH.$resultsHolder.hide()},clearResults:function(){SEARCH.$resultsHolder.find("#resultsHolder").html("");SEARCH.$resultsHolder.find("#resultsHolderFilter").html("")},showSavedSearches:function(){var c=b("#saved-searches-header").html();SEARCH.$resultsHolder.find("#resultsHolder").html(c)},closeAdvancedSearch:function(){if(b("#mega-filter-wrapper").length){b("#mega-filter-wrapper").fadeOut()}},url:DATA.url,pc:DATA.pc,autocomplete:function(y){SEARCH.clearResults();SEARCH.showSavedSearches();y=y.replace(/^\s+|\s+$/,"");var n=b("#advanced-mega-search-form").find("[name='prod[]']").val(),D=b("#advanced-mega-search-form").find("[name='lang[]']").val(),c=b("#advanced-mega-search-form").find("[name='indu[]']").val(),w=b("#dtyp").val();var B={keyword:y};if(n){B.prod=n}if(D){B.lang=D}if(c){B.indu=c}if(w){B.type=w}var f=SEARCH.hashCode(JSON.stringify(B));if(SEARCH.autocompleteCache.hasOwnProperty(f)){var d=SEARCH.autocompleteCache[f];var A=SEARCH.$keyword.val().replace(/^\s+|\s+$/,"");if(y===A){SEARCH.$resultsHolder.find("#resultsHolder").html(d).css("border-right-width",0).end().show()}}else{SEARCH.$resultsHolder.find("#resultsHolder").html("Loading ...");b.ajax({type:"POST",url:SEARCH.url,data:B,dataType:"html",success:function(v){var i=SEARCH.$keyword.val().replace(/^\s+|\s+$/,"");if(v.match(/\S/)&&!v.match(/login.html/)){if(y===i&&!SEARCH.disableSubmit){SEARCH.$resultsHolder.find("#resultsHolder").html(v).css("border-right-width",0).end().show()}SEARCH.autocompleteCache[f]=v}else{SEARCH.$resultsHolder.find("#resultsHolder").html("")}},complete:function(){delete SEARCH.timeout}})}var p=y.split(" ").pop();var j=getAutocompleteItems();var C=[];if(p){C=SEARCH.filter(j,p);if(C.length===0){C=b.ui.autocomplete.filter(j,p)}}if(C.length>0){var x=b('<div class="resultlist">');var e=b("<ul>").appendTo(x);for(var t in C){var k=parseInt(t)+1;var u=C[t];var r="Set filter: ";var o=false;var m=Array.isArray(u.id)?u.id:[u.id];if(SEARCH.autocompleteFilters.hasOwnProperty(u.type)){r="Add filter: ";var h=u.type;var l=b("#advanced-mega-search-form");var g=l.find('[name="'+h+'[]"]');var z=g.val()||[];var o=true;for(var q in m){if(z.indexOf(m[q])===-1){o=false}}if(SEARCH.autocompleteFilters[u.type].hasOwnProperty(u.key)&&o){if(C.length>1&&C.length>k){continue}}if(o){r="Filter was added: "}}var s={};if(o){s=b('<span class="ac-filter-added"></span>')}else{s=b('<a href="javascript://" class="ac-filter-link"></a>')}s.attr("data-id",u.id).attr("data-type",u.type).attr("data-key",u.key).attr("data-keyword",p).html(r+'<span class="tt-u">'+u.label+"</span>");b("<li>").html(s).appendTo(e);break}SEARCH.$resultsHolder.show().find("#resultsHolderFilter").html(x).show()}},search:function(c){if(SEARCH.disableSubmit){openLoadingDialog();c.preventDefault();return false}SEARCH.disableSubmit=true;SEARCH.closeResults();openLoadingDialog();return true},keywordKeyUp:function(c){var d=b(this).val();var f=function(){SEARCH.autocomplete(d)};if(!d.length||d.length<SEARCH.minLength||c.keyCode===27){if(d.length<SEARCH.minLength){SEARCH.clearResults();SEARCH.showSavedSearches()}return}if(SEARCH.timeout){clearTimeout(SEARCH.timeout);delete SEARCH.timeout}SEARCH.timeout=setTimeout(f,SEARCH.autoCompleteDelay)},keywordFocus:function(){SEARCH.$resultsHolder.show()},SetCookie:function(g,f,e){var d=new Date(),c=new Date();e=e||1;c.setTime(c.getTime()+(+3600000*24*e));b.cookie(g,escape(f),{expires:c,domain:Emis.cookieDomain,path:"/"})},GetCookie:function(e){var f,g,d=document.cookie.split(";");e+="=";for(f=0;f<d.length;f+=1){g=d[f];while(g.charAt(0)===" "){g=g.substring(1,g.length)}if(!g.indexOf(e)){return g.substring(e.length,g.length)}}return""}};b(SEARCH.init);RefineSEARCH={minLength:2,autoCompleteDelay:300,disableSubmit:false,autocompleteFilters:{},autocompleteCache:{},init:function(){RefineSEARCH.$keyword=b("#keyword_search").on("keyup",RefineSEARCH.keywordKeyUp).on("keydown",RefineSEARCH.keywordKeyDown).on("focus click",RefineSEARCH.keywordFocus);RefineSEARCH.$form=RefineSEARCH.$keyword.closest("form").on("submit",RefineSEARCH.search);RefineSEARCH.$savedSearches=RefineSEARCH.$keyword.closest("form").find(".js-savedsearches-slide");if(b("#dtyp-type").val()){RefineSEARCH.$type=b("#dtyp-type").val()}RefineSEARCH.$resultsHolder=b('<div id="resultsWrapperRefine" class="resultsWrapper" style="top:100%;"><div id="resultsHolderFilterRefine" class="d-n"></div><div id="resultsHolderRefine" class="resultsHolder">Searching...</div></div>').insertAfter(RefineSEARCH.$savedSearches);b(document.body).on("click",RefineSEARCH.checkCloseResults)},checkCloseResults:function(c){var d=b(c.srcElement);if(!d.closest("#resultsWrapperRefine").length&&!d.closest("#keyword_search").length){RefineSEARCH.closeResults()}},closeResults:function(){RefineSEARCH.$resultsHolder.hide()},clearResults:function(){RefineSEARCH.$resultsHolder.find("#resultsHolderRefine").html("");RefineSEARCH.$resultsHolder.find("#resultsHolderFilterRefine").html("")},url:DATA.url,pc:DATA.pc,autocomplete:function(u){RefineSEARCH.clearResults();u=u.replace(/^\s+|\s+$/,"");var y={keyword:u};if(typeof RefineSEARCH.$type!=="undefined"&&RefineSEARCH.$type.length){y.type=RefineSEARCH.$type}var e=SEARCH.hashCode(JSON.stringify(y));if(RefineSEARCH.autocompleteCache.hasOwnProperty(e)){var c=RefineSEARCH.autocompleteCache[e];var x=RefineSEARCH.$keyword.val().replace(/^\s+|\s+$/,"");if(u===x){RefineSEARCH.$resultsHolder.find("#resultsHolderRefine").html(c).css("border-right-width",0).end().show()}}else{RefineSEARCH.$resultsHolder.find("#resultsHolder").html("Loading ...");b.ajax({url:RefineSEARCH.url,data:y,dataType:"html",success:function(v){var i=RefineSEARCH.$keyword.val().replace(/^\s+|\s+$/,"");if(v.match(/\S/)&&!v.match(/login.html/)){if(u===i){RefineSEARCH.$resultsHolder.find("#resultsHolderRefine").html(v).css("border-right-width",0).end().show()}RefineSEARCH.autocompleteCache[e]=v}else{RefineSEARCH.$resultsHolder.find("#resultsHolder").html("")}},complete:function(){delete RefineSEARCH.timeout}})}var m=u.split(" ").pop();var g=getAutocompleteItems();var z=[];if(m){z=SEARCH.filter(g,m);if(z.length===0){z=b.ui.autocomplete.filter(g,m)}}if(z.length>0){var t=b('<div class="resultlist">');var d=b("<ul>").appendTo(t);for(var r in z){var j=parseInt(r)+1;var s=z[r];var p="Set filter: ";var n=false;var l=Array.isArray(s.id)?s.id:[s.id];if(RefineSEARCH.autocompleteFilters.hasOwnProperty(s.type)){p="Add filter: ";var h=s.type;var k=b("#search_form");var f=k.find('[name="'+h+'[]"]');var w=f.val()||[];var n=true;for(var o in l){if(w.indexOf(l[o])===-1){n=false}}if(RefineSEARCH.autocompleteFilters[s.type].hasOwnProperty(s.key)&&n){if(z.length>1&&z.length>j){continue}}if(n){p="Filter was added: "}}var q={};if(n){q=b('<span class="ac-filter-added"></span>')}else{q=b('<a href="javascript://" class="ac-filter-link"></a>')}q.attr("data-id",s.id).attr("data-type",s.type).attr("data-key",s.key).attr("data-keyword",m).html(p+s.label);b("<li>").html(q).appendTo(d);break}RefineSEARCH.$resultsHolder.show().find("#resultsHolderFilterRefine").html(t).show()}},search:function(c){if(RefineSEARCH.disableSubmit){openLoadingDialog();c.preventDefault();return false}RefineSEARCH.disableSubmit=true;openLoadingDialog();return true},keywordKeyDown:function(c){if(c.keyCode===13){c.preventDefault();searchSubmit();return false}},keywordKeyUp:function(d){var f=b(this).val(),c=function(){RefineSEARCH.autocomplete(f)};if(!f.length||f.length<RefineSEARCH.minLength||d.keyCode===27){RefineSEARCH.closeResults();if(f.length<SEARCH.minLength){RefineSEARCH.clearResults()}return}if(!RefineSEARCH.timeout){clearTimeout(RefineSEARCH.timeout);delete RefineSEARCH.timeout}RefineSEARCH.timeout=setTimeout(c,RefineSEARCH.autoCompleteDelay)},keywordFocus:function(){b(".js-savedsearches-slide").slideDown("slow")}};b(RefineSEARCH.init)}(this));